"use strict";var schedules,firstContact,rawFile=new XMLHttpRequest;rawFile.open("GET","duruduru.txt",!1),rawFile.setRequestHeader("Content-Type","text/html;charset=utf-8"),rawFile.onreadystatechange=function(){if(4===rawFile.readyState&&(200===rawFile.status||0==rawFile.status)){var a=rawFile.responseText;schedules=a.split("|||")[0],firstContact=a.split("|||")[1]}},rawFile.send(null);var DATE=0,PUBLIC=1,PARTICIPANTS=2,dataSchedules=[],dataCoOccuranceList={},dataFirstContact={},dataBonus={},dataScores=[];for(var key in schedules.split("|").forEach(function(a){var e=a.split("\t");if(!(e.length<4)){var t=[];t[DATE]=e[0],"Y"==e[1]?t[PUBLIC]=!0:t[PUBLIC]=!1,t[PARTICIPANTS]=[];for(var n=2;n<e.length;n++)e[n].length>0&&t[PARTICIPANTS].push(e[n]);dataSchedules.push(t)}}),dataSchedules.forEach(function(a){for(var e=0;e<a[PARTICIPANTS].length-1;e++){var t=a[PARTICIPANTS][e].trim();null==dataCoOccuranceList[t]&&(dataCoOccuranceList[t]=new Set,dataFirstContact[t]=new Set,dataBonus[t]=0);for(var n=e+1;n<a[PARTICIPANTS].length;n++){var r=a[PARTICIPANTS][n].trim();null==dataCoOccuranceList[r]&&(dataCoOccuranceList[r]=new Set,dataFirstContact[r]=new Set,dataBonus[r]=0),dataCoOccuranceList[t].add(r),dataCoOccuranceList[r].add(t)}}if(1==a[PUBLIC]){dataBonus[a[PARTICIPANTS][0].trim()]+=2;for(var c=1;c<a[PARTICIPANTS].length;c++)dataBonus[a[PARTICIPANTS][c].trim()]+=1}}),firstContact.split("|").forEach(function(a){if(0!=a.length){var e=a.split("\t");if(!(e.length<2)){var t=e[0].trim(),n=e[1].trim();null!=dataFirstContact[t]&&null!=dataFirstContact[n]&&(dataFirstContact[t].add(n),dataFirstContact[n].add(t))}}}),dataBonus)dataScores.push({score:dataBonus[key]+dataCoOccuranceList[key].size+dataFirstContact[key].size,name:key});dataScores.sort(function(a,e){return a.score>e.score?-1:a.score<e.score?1:a.name>e.name?1:a.name<e.name?-1:0}),console.log("dataSchedules",dataSchedules),console.log("dataCoOccuranceList",dataCoOccuranceList),console.log("dataBonus",dataBonus),console.log("dataScores",dataScores);var tlbTopBoard=document.getElementById("tlbTopBoard"),rankingIdx=1,prevRankingIdx=0,prevScore=0;dataScores.forEach(function(a){var e=document.createElement("tr");tlbTopBoard.appendChild(e);var t=document.createElement("td");e.appendChild(t),prevScore!=a.score?t.innerHTML=rankingIdx:t.innerHTML=prevRankingIdx,prevRankingIdx=t.innerHTML,rankingIdx+=1,prevScore=a.score;var n=document.createElement("td");e.appendChild(n),n.innerHTML=a.name;var r=document.createElement("td");e.appendChild(r);var c=a.score+" = "+dataCoOccuranceList[a.name].size+" (함께한 사람수)";a.score-dataCoOccuranceList[a.name].size>0&&(c=c+" + "+(a.score-dataCoOccuranceList[a.name].size)+" (가산점)"),r.innerHTML=c;var d=document.createElement("td");e.appendChild(d);var o="";dataCoOccuranceList[a.name].forEach(function(e){o+="<span",1==dataFirstContact[a.name].has(e)&&(o+=" class='colorRed'"),o+=">",o+=e,o+="</span> "}),d.innerHTML=o});var tblSchdules=document.getElementById("tblSchdules");dataSchedules.forEach(function(a){var e=document.createElement("tr");tblSchdules.appendChild(e);var t=document.createElement("td");e.appendChild(t),t.innerHTML=a[DATE];var n=document.createElement("td");e.appendChild(n),1==a[PUBLIC]?n.innerHTML="Y":n.innerHTML="N";var r=document.createElement("td");e.appendChild(r),r.innerHTML=a[PARTICIPANTS][0];var c=document.createElement("td");e.appendChild(c);for(var d="",o=1;o<a[PARTICIPANTS].length;o++)d+=a[PARTICIPANTS][o]+" ";c.innerHTML=d});
